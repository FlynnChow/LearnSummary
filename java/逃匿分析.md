## 逃逸分析

逃逸分析（Escape Analysis）简单来讲就是，Java Hotspot 虚拟机可以分析新创建对象的使用范围，并决定是否在 Java 堆上分配内存的一项技术。

Java的逃逸分析只发在JIT的即时编译中，Java的分离编译和动态加载使得前期的静态编译的逃逸分析比较困难或收益较少。

### 逃匿状态

#### 全局逃匿

一个对象是否逃匿了当前线程或方法

* 对象是一个静态变量
* 对象是一个已经逃匿的对象
* 对象是一个方法的返回值

### 逃逸分析优化

#### 锁消除

线程同步锁是非常牺牲性能的，当编译器确定当前对象只有当前线程使用，那么就会移除该对象的同步锁

#### 标量替换

基础类型和对象的引用可以理解为标量，它们不能再被分解

如果一个对象没有发生逃逸，那压根就不用创建它，只会在栈或者寄存器上创建它用到的成员标量，节省了内存空间

#### 栈上分配

当对象没有发生逃逸时，该对象就可以通过标量替换分解成成员标量分配在栈内存中，和方法的生命周期一致，随着栈帧出栈时销毁，减少了 GC 压力